version: "3.9"

services:
  php81:
    image: codeception-module-db-php81:3.x
    build:
      context: .
      dockerfile: ./php81.Dockerfile
    environment:
      MYSQL_DSN: ${MYSQL_DSN:-mysql:host=mysql57;port=3306;dbname=codeception}
      MYSQL_USER: ${MYSQL_USER:-root}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-codeception}
      XDEBUG_MODE: "debug"
      XDEBUG_CONFIG: "client_host=host.docker.internal; client_port=9000; mode=debug; start_wih_request=1"
      PHP_IDE_CONFIG: "serverName=codeception-module-db" # the name must be the same as in your PHP -> Server -> "name" field
    volumes:
      - ".:/var/www/html"

  mysql57:
    image: mysql:5.7
    platform: linux/amd64
    environment:
      MYSQL_ROOT_PASSWORD: codeception
      MYSQL_DATABASE: codeception
    ports:
      - "3102:3306"

